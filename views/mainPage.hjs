<!DOCTYPE html>
<html>

<head>
  <title>CSP Demo</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" nonce="{{nonce}}"></script>
		<link rel="stylesheet" type="text/css" href="style.css">
		<link href="https://fonts.googleapis.com/css?family=Amatic+SC" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Fredoka+One" rel="stylesheet">
    
    {{#FineGrainedTT}}

    <meta http-equiv="Content-Security-Policy" content="require-trusted-types-for 'script'">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.2.7/purify.min.js"></script>

    <script>
    if (window.trustedTypes && trustedTypes.createPolicy) { // Feature testing
      trustedTypes.createPolicy('default', {
        createHTML: string => DOMPurify.sanitize(string, {RETURN_TRUSTED_TYPE: true})
      });
    }
    </script>
    {{/FineGrainedTT}}
</head>

<body>
  <h2 id="langIcon" > </h2>
  <a id="lang" style="display: none;"> </a>
  <script src="./lang.js" nonce="{{nonce}}"></script>
  
  <h1>CSP Demo</h1>
  <div>
    Current CSP:&nbsp;&nbsp;
    <span style="white-space: pre; font-family: monospace;">{{activeCspString}}</span>
  </div>
  <p>
    Example of how to exploit it:&nbsp;&nbsp;
    <i>{{activeCspVersion.exploit}}</i>
  </p>
  <div>
    
    Switch to CSP protection:
    {{#cspVersions}}
    &nbsp;&nbsp;&nbsp;&nbsp;<a href="{{basePath}}{{url}}" class="button2">{{label}}</a>
    {{/cspVersions}}
  </div>
  
  <hr>
  
  <div class="search-container">
  <form action="{{basePath}}{{reqPath}}" method="get">
    <input type="search" name="q" value="{{searchedType}}" placeholder="Search type ..." size="70">
    <input type="submit" value="Search">
  </form>
  </div>
  
  <h2>We propose the following films for <b>{{{searchedType}}}</b> type:</h2>
  <table id="films">
    <tr>
      <th>Title</th>
      <th>Type</th>
      <th></th>
      <th></th>
    </tr>
    {{#films}}
    <tr class="movie">
      <td>{{title}}</td>
      <td>{{type}}</td>
      <td><button type="button" class="btn-toggle">Show more</button></td>
      <td class="description" style="display: none;">{{{description}}}</td>
    </tr>
    {{/films}}
  </table>
  <script src="./movies.js" nonce="{{nonce}}"></script>
</body>

<footer id="end" class = "footer" >
				<a href="#top" class="button2"> return top </a><br><br>
				&copy; 2022, CSP demonstration
		</footer>


</html>